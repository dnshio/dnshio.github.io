<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>PhpSpec is a bloody nightmare &#8211; dnsh.io</title>
    <link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com">
    <link rel="dns-prefetch" href="//cdn.mathjax.org">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="One mans rant is another mans bant.">
    <meta name="robots" content="all">
    <meta name="author" content="Dinesh Vitharanage">
    
    <meta name="keywords" content="Programming">
    <link rel="canonical" href="http://dvitharanage.github.io/programming/2016/09/22/phpspec-is-a-bloody-nightmare/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for dnsh.io" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?201609230030" type="text/css">

    <!-- Fonts -->
    
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- MathJax -->
    

    <!-- Verifications -->
    
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_UK">
    <meta property="og:type" content="article">
    <meta property="og:title" content="PhpSpec is a bloody nightmare">
    <meta property="og:description" content="PhpSpec is a bloody nightmare sometimes">
    <meta property="og:url" content="http://dvitharanage.github.io/programming/2016/09/22/phpspec-is-a-bloody-nightmare/">
    <meta property="og:site_name" content="dnsh.io">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@killneel" />
    
    <meta name="twitter:title" content="PhpSpec is a bloody nightmare" />
    <meta name="twitter:description" content="One mans rant is another mans bant." />
    <meta name="twitter:url" content="http://dvitharanage.github.io/programming/2016/09/22/phpspec-is-a-bloody-nightmare/" />

    <!-- Icons -->
    <!--<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">-->
    <!--<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">-->
    <!--<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">-->
    <!--<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">-->
    <!--<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">-->
    <!--<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">-->
    <!--<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">-->
    <!--<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">-->
    <!--<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">-->
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <!--<link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">-->
    <!--<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">-->
    <!--<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">-->
    <!--<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">-->

    
</head>

<body class="site">
  
	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="http://dvitharanage.github.io" class="site-title">dnsh.io</a>
      <nav class="site-nav">
        
    

    
        <a href="/about/">About Me</a>
    

    

    

    

    

    

    


    

    

    
        <a href="/contact/">Sup</a>
    

    

    

    

    

    


      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="social-icons-right">
    
      <a class="fa fa-github" href="https://github.com/dvitharanage"></a>
    
    
    
    <a class="fa fa-rss" href="/feed.xml"></a>
    
      <a class="fa fa-twitter" href="https://twitter.com/killneel"></a>
    
    
    
    
    
      <a class="fa fa-envelope" href="mailto:dvitharanage@gmail.com"></a>
    
    
      <a class="fa fa-linkedin" href="https://www.linkedin.com/in/dvitharanage"></a>
    
    
    
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>PhpSpec is a bloody nightmare</h1>
  <span class="post-meta">Sep 22, 2016</span><br>
  
  <span class="post-meta small">
  
    4 minute read
  
  </span>
</div>

<article class="post-content">
  <p>At MJM, we use PhpSpec for unit-testing our code. One might argue that these should not be called unit tests since
you write specifications rather than tests. Call it what you will - we can have that argument another day. Today I will
rant about the good and some of the bad things about it.</p>

<p>In a nutshell, PhpSpec helps bring the TDD buzzword to the PHP world. By allowing you to mock shit straight off the bat,
PhpSpec makes it difficult to come up with excuses like <em>“I wrote the feature but I haven’t written any tests yet”</em>.
Again, I’m not pissed off about that.</p>

<p>In fact, I actually like it because I’m lazy and PhpSpec generates shit for me. I
just make grand statements like <em>“Oh, I got a Some\Bullshit. And it takes a CrunkJuiceFactory as a constructor
argument. And I can getJuice() from CrunkJuiceFactory anytime I want and it’ll give me n number of juice hits”</em>. That’s just
what I told my manager, I haven’t written any of it yet. So I’m like shit… better get that scaffolded. So I do:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">bin/phpspec desc Some/Bullshit</code></pre></figure>

<p>Then PhpSpec just makes a specification for you with nothing much is in it but you can’t argue with that since you haven’t
done any work yet yourself. But you don’t care. You’re like <strong><em>“Sick! I’m done! I’m gonna just run this test and go home!”</em></strong>
because you’re all TDD now and they all tell you life is good when you TDD. So, you:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">bin/phpspec run spec/Some/BullshitSpec.php</code></pre></figure>

<p>Just as you were about to leave, you remember that it’s only 9.30am and you kindda need to write the feature still. Argh!
FINE!!!! PhpSpec got yo back though. It already noticed that you’ve done fuckall so it asks you…</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Some/Bullshit
  10  - it is initializable
      class Some<span class="se">\B</span>ullshit does not exist.

1 specs
1 example <span class="o">(</span>1 broken<span class="o">)</span>
36ms

  Do you want me to create Some<span class="se">\B</span>ullshit <span class="k">for </span>you? <span class="o">[</span>Y/n]</code></pre></figure>

<p>You take <code class="highlighter-rouge">Y</code>, and spec gives you your new file and you are ready to write some code. The thought creeps to your mind that
I could have just done the same thing with your IDE with 3 clicks and you don’t have to keep chatting to a terminal. You are
correct. But that’s not where Spec saves you. Now is the time Spec REAAAALY start to give you bacon. You start mocking the
shit out of your object immediately, winning from the get go:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">spec\Some</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">PhpSpec\ObjectBehavior</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Prophecy\Argument</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BullshitSpec</span> <span class="k">extends</span> <span class="nx">ObjectBehavior</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">let</span><span class="p">(</span><span class="nx">CrunkJuiceFactory</span> <span class="nv">$cjFactory</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$cjFactory</span><span class="o">-&gt;</span><span class="na">getJuice</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">beConstructedWith</span><span class="p">(</span><span class="nv">$cjFactory</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre></figure>

<p>You just noticed that you started describing behaviour of <code class="highlighter-rouge">CrunkJuiceFactory</code> and making claims about what it will do even
before you wrote anything. You can now start to write your <code class="highlighter-rouge">Bullshit</code> behaviour without having to write too much other bullshit.
So… it’s kindda nice. So you become dependant on it. But with any shit that gets you hooked, you eventually come to
find yourself in that moment of overdose where you are like <strong><em>“WTF dawg???”</em></strong>.</p>

<p>That moment in PhpSpec happens when you are testing your tests. Spec gets fucking weird here because it’s doing shit load of
magic and you just don’t understand any of that shit because you never needed to. One such problem is when you are testing
some code that you have wrapped around a <code class="highlighter-rouge">try .. catch</code> block coz you are a G and you don’t run away from your exceptions.</p>

<p>If you cause a PhpSpec error, inside a try catch block in your subject (like making a call to a method that you didn’t describe
in the spec) then you are going to spend fucking hours trying to figure why PhpSpec keep running forever and eventually die
without giving you any bacon. Or anything for that matter.</p>

<p>Let me explain better:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">getBacon</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$bacon</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">baconFactory</span><span class="o">-&gt;</span><span class="na">getSome</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">NoBaconException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logger</span><span class="o">-&gt;</span><span class="na">critical</span><span class="p">(</span><span class="s2">"OUT OF BACON!!!! :O"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>In the above scenario, if you had forgotten to mock <code class="highlighter-rouge">getSome()</code> method in your <code class="highlighter-rouge">BaconFactory</code> object inside your spec then
PhpSpec will throw an Exception right where that ‘Undefined method’ was called. This means that the exception gets caught
by your subject and not PhpSpec itself. And then PhpSpec hangs. And you have no idea WTF just happened. Nothing in the
terminal. Yeah.</p>

<p><strong>So how do you deal with this?</strong></p>

<p>If you come across this sorry situation in your life, try and narrow down exactly which spec is hanging. And then you will
probably notice that your subject has a try catch block. Then stick a var_dump in the catch block with the exception message
and die. It’ll show you the message on your terminal so you can move forward.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">getBacon</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$bacon</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">baconFactory</span><span class="o">-&gt;</span><span class="na">getSome</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">NoBaconException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span><span class="k">die</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logger</span><span class="o">-&gt;</span><span class="na">critical</span><span class="p">(</span><span class="s2">"OUT OF BACON!!!! :O"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Oh, and don’t forget to remove the die statement once you are done debugging.</p>

</article>


  <div class="share-page">
  Spread this shit!

  <div class="share-links">
    

    
      <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?text=PhpSpec is a bloody nightmare&url=http://dvitharanage.github.io/programming/2016/09/22/phpspec-is-a-bloody-nightmare/" rel="nofollow" target="_blank" title="Spread this on Twittah"></a>
    

    

    

    

    
      <a class="fa fa-tumblr" href="http://www.tumblr.com/share/link?url=http://dvitharanage.github.io/programming/2016/09/22/phpspec-is-a-bloody-nightmare/&name=PhpSpec is a bloody nightmare" rel="nofollow" target="_blank" title="Spread this on Tumblr"></a>
    

    
      <a class="fa fa-reddit" href="http://reddit.com/submit?url=http://dvitharanage.github.io/programming/2016/09/22/phpspec-is-a-bloody-nightmare/&title=PhpSpec is a bloody nightmare" rel="nofollow" target="_blank" title="Spread this on Reddit"></a>
    

    
      <a class="fa fa-stumbleupon" href="http://www.stumbleupon.com/submit?url=http://dvitharanage.github.io/programming/2016/09/22/phpspec-is-a-bloody-nightmare/&title=PhpSpec is a bloody nightmare" rel="nofollow" target="_blank" title="Spread this on StumbleUpon"></a>
    

    
      <a class="fa fa-hacker-news" onclick="parent.postMessage('submit','*')" href="https://news.ycombinator.com/submitlink?u=http://dvitharanage.github.io/programming/2016/09/22/phpspec-is-a-bloody-nightmare/&t=PhpSpec is a bloody nightmare" rel="nofollow" target="_blank" title="Spread this on Hacker News"></a>
    
  </div>
</div>




  <div class="py2 post-footer">
  <p>

  </p>
</div>




  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname  = 'dnshio';
    var disqus_identifier = '/programming/2016/09/22/phpspec-is-a-bloody-nightmare';
    var disqus_title      = "PhpSpec is a bloody nightmare";

    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
    <small>
      All your base are belong to Dinesh Vitharanage. 2016 &copy; <br />
      Check out my forks on <a href="https://github.com/dvitharanage">Github</a>.
    </small>
  </div>
</footer>


</body>
</html>
